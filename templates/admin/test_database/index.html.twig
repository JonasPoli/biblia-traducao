{% extends 'admin/base.html.twig' %}

{# ---------------------------------------------------------------------------
   Este arquivo é a versão "bonita" gerada a partir do CRUD padrão
   (templates/admin/test_database_controller2/index.html.twig).
   Quando criar outro CRUD com `bin/console make:crud`, copie os blocos
   comentados abaixo para aplicar o mesmo layout + DataTable.
--------------------------------------------------------------------------- #}

{% block stylesheets %}
    {{ parent() }}
    {# Copie este link para habilitar DataTables no novo CRUD #}
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {# DataTables 2 ainda depende de jQuery global -> inclua antes do plugin #}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.3/js/dataTables.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof window.jQuery === 'undefined' || typeof window.jQuery.fn.DataTable === 'undefined') {
                return;
            }

            $('#test-database-table').DataTable({
                pageLength: 100,
                lengthMenu: [[25, 50, 100, 250], [25, 50, 100, 250]],
                responsive: true,
                language: {
                    search: 'Buscar:',
                    info: 'Mostrando _START_ até _END_ de _TOTAL_ registros',
                    infoEmpty: 'Nenhum registro disponível',
                    lengthMenu: 'Mostrar _MENU_ itens',
                    paginate: {
                        first: 'Primeiro',
                        last: 'Último',
                        next: 'Próximo',
                        previous: 'Anterior'
                    },
                    zeroRecords: 'Nada encontrado'
                }
            });
        });
    </script>
{% endblock %}

{% block body %}
<div class="space-y-8">
    {# Hero Shoelace: copie para o novo CRUD e troque o título/descrição #}
    <section class="rounded-[32px] bg-white/80 p-6 shadow-xl shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500 dark:text-slate-400">Test Databases</p>
                <h1 class="mt-2 text-3xl font-semibold text-slate-900 dark:text-white">Catálogo de registros</h1>
                <p class="mt-2 max-w-2xl text-sm text-slate-500 dark:text-slate-400">
                    Use esta lista para validar o CRUD gerado e testar fluxos de criação/edição dentro do painel administrativo.
                </p>
            </div>
            <div class="flex flex-wrap gap-3">
                <sl-button size="large" variant="default" outline href="{{ path('app_admin_test_database_new') }}">
                    <sl-icon slot="prefix" name="plus-lg"></sl-icon>
                    Novo registro
                </sl-button>
            </div>
        </div>
    </section>

    {# Card + DataTable responsivo (copiar e ajustar colunas e rotas) #}
    <sl-card class="border-none bg-white/85 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
        <div slot="header" class="flex flex-wrap items-center justify-between gap-4">
            <div>
                <p class="text-lg font-semibold text-slate-900 dark:text-white">Lista</p>
                <p class="text-sm text-slate-500 dark:text-slate-400">
                    DataTables habilitado: pesquisa instantânea, ordenação e paginação com 100 itens por página.
                </p>
            </div>
        </div>

        {% if test_databases is empty %}
            <sl-alert variant="neutral" open>
                <sl-icon slot="icon" name="inbox"></sl-icon>
                Nenhum registro ainda — clique em “Novo registro” para criar o primeiro item.
            </sl-alert>
        {% else %}
            <div class="overflow-x-auto">
                <table id="test-database-table" class="min-w-full text-left text-sm">
                    <thead>
                        <tr class="border-b border-slate-100 text-xs uppercase tracking-[0.3em] text-slate-500 dark:border-white/5 dark:text-slate-400">
                            <th class="py-3 pr-4">ID</th>
                            <th class="py-3 pr-4">Nome</th>
                            <th class="py-3 pr-4">Ações</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                        {% for test_database in test_databases %}
                            <tr class="hover:bg-slate-50/70 dark:hover:bg-white/5">
                                <td class="py-3 pr-4 font-mono text-xs text-slate-500 dark:text-slate-400">#{{ test_database.id }}</td>
                                <td class="py-3 pr-4 font-medium text-slate-900 dark:text-white">{{ test_database.name }}</td>
                                <td class="py-3 pr-4">
                                    <div class="flex flex-wrap gap-2">
                                        <sl-button size="small" variant="default" outline href="{{ path('app_admin_test_database_show', {'id': test_database.id}) }}">
                                            <sl-icon slot="prefix" name="eye"></sl-icon>
                                            Ver
                                        </sl-button>
                                        <sl-button size="small" variant="primary" href="{{ path('app_admin_test_database_edit', {'id': test_database.id}) }}">
                                            <sl-icon slot="prefix" name="pencil-square"></sl-icon>
                                            Editar
                                        </sl-button>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </sl-card>
</div>
{% endblock %}
