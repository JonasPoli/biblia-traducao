{% extends 'admin/base.html.twig' %}

{% block body %}

    <div class="space-y-10">
        <section class="rounded-[32px] bg-white/80 p-8 shadow-xl shadow-slate-900/5 ring-1 ring-white/60 backdrop-blur dark:bg-slate-900/60 dark:ring-white/10">
            <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
                <div>
                    <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500 dark:text-slate-400">Painel</p>
                    <h1 class="mt-3 text-3xl font-semibold text-slate-900 dark:text-white">Visão geral do ecossistema</h1>
                    <p class="mt-2 max-w-2xl text-sm text-slate-500 dark:text-slate-400">
                        KPIs, atividade recente e formulários de controle usando componentes Shoelace.
                    </p>
                </div>
                <div class="flex flex-wrap gap-3">
                    <sl-button size="large" variant="primary">
                        <sl-icon slot="prefix" name="rocket"></sl-icon>
                        Nova campanha
                    </sl-button>
                    <sl-button size="large" variant="default" outline>
                        <sl-icon slot="prefix" name="download"></sl-icon>
                        Exportar dados
                    </sl-button>
                </div>
            </div>
        </section>

        <section class="grid gap-6 lg:grid-cols-4">
            {% set statCards = [
                {
                    icon: 'speedometer',
                    label: 'Performance',
                    value: '98',
                    suffix: '/100',
                    tone: 'text-emerald-500',
                    note: '+4 pts vs semana anterior'
                },
                {
                    icon: 'people',
                    label: 'Usuários ativos',
                    value: '2.481',
                    suffix: '',
                    tone: 'text-sky-500',
                    note: '+18% orgânico'
                },
                {
                    icon: 'cart',
                    label: 'Pedidos',
                    value: '324',
                    suffix: ' hoje',
                    tone: 'text-indigo-500',
                    note: '4% de aprovação manual'
                },
                {
                    icon: 'piggy-bank',
                    label: 'Receita',
                    value: 'R$ 182k',
                    suffix: '',
                    tone: 'text-amber-500',
                    note: 'Meta mensal em 76%'
                }
            ] %}
            {% for card in statCards %}
                <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400">{{ card.label }}</p>
                            <p class="mt-2 text-3xl font-semibold text-slate-900 dark:text-white">
                                {{ card.value }} <span class="text-base font-normal text-slate-400">{{ card.suffix }}</span>
                            </p>
                            <p class="mt-2 text-xs font-medium {{ card.tone }}">{{ card.note }}</p>
                        </div>
                        <sl-icon name="{{ card.icon }}" class="text-2xl text-slate-400 dark:text-slate-500"></sl-icon>
                    </div>
                </sl-card>
            {% endfor %}
        </section>

        {# Indicadores e Seções (única vez) #}
        <section class="space-y-6">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Indicadores Adicionais</h2>
            <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                <div slot="header">
                    <p class="text-lg font-semibold text-slate-900 dark:text-white">Visão Detalhada</p>
                </div>
                <ul class="space-y-3 text-slate-700 dark:text-slate-300">
                    <li><strong>Indicadores gerais:</strong> número total de projetos ativos, peças em produção, peças em pintura, grupos formados, pacotes prontos e montagens concluídas.</li>
                    <li><strong>Progresso por projeto:</strong> barra de progresso para cada projeto mostrando percentuais de fabricação, pintura e embalagem.</li>
                    <li><strong>Pacotes prontos para expedição:</strong> lista de pacotes fechados aguardando transporte, com destino e data prevista de envio.</li>
                    <li><strong>Alertas e pendências:</strong> peças que entraram na pintura e ainda não saíram, projetos com peças fora do prazo, pacotes incompletos ou peças sem etiqueta.</li>
                    <li><strong>Gráfico de produção diária/semana:</strong> peças produzidas por dia ou semana, permitindo identificar picos ou gargalos.</li>
                    <li><strong>Gráfico de tempo de pintura:</strong> tempo médio gasto na pintura por tipo de peça ou projeto, facilitando ajustes no planejamento.</li>
                    <li><strong>Status das máquinas de impressão:</strong> filas de etiquetas nas três impressoras (pré‑montagem, pintura, embalagem), último erro de impressão e volume de etiquetas geradas.</li>
                    <li><strong>Tempo médio de montagem:</strong> indicador de quanto tempo os montadores levam para montar um projeto após receber os pacotes.</li>
                    <li><strong>Comparativo de estimativas versus real:</strong> painel que mostra a diferença entre horas previstas e horas gastas em cada etapa, auxiliando na revisão das estimativas.</li>
                    <li><strong>Top clientes / projetos:</strong> ranking de projetos com maior volume de peças ou valor de produção, útil para identificar clientes estratégicos.</li>
                </ul>
            </sl-card>
        </section>

        <section class="grid gap-6 lg:grid-cols-[2fr_1fr]">
            <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                <div slot="header" class="flex flex-wrap items-center justify-between gap-4">
                    <div>
                        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400">Pipeline</p>
                        <p class="text-lg font-semibold text-slate-900 dark:text-white">Novas contas</p>
                    </div>
                    <sl-badge variant="success" pill>Atualizado há 5 min</sl-badge>
                </div>
                <div class="grid gap-6 lg:grid-cols-2">
                    <div class="space-y-3">
                        <div>
                            <p class="text-sm font-semibold text-slate-600 dark:text-slate-200">Onboarding</p>
                            <sl-progress-bar value="68"></sl-progress-bar>
                            <p class="text-xs text-slate-500 dark:text-slate-400">68% dos convites foram aceitos</p>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-slate-600 dark:text-slate-200">Treinamentos</p>
                            <sl-progress-bar value="42" class="accent-indigo-500"></sl-progress-bar>
                            <p class="text-xs text-slate-500 dark:text-slate-400">42% concluíram a trilha obrigatória</p>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-slate-600 dark:text-slate-200">KPIs entregues</p>
                            <sl-progress-bar value="87" class="accent-emerald-500"></sl-progress-bar>
                            <p class="text-xs text-slate-500 dark:text-slate-400">87% de aderência</p>
                        </div>
                    </div>
                    <div class="flex flex-col items-center justify-center gap-4">
                        <sl-progress-ring value="76" size="120" stroke-width="10"></sl-progress-ring>
                        <div class="text-center">
                            <p class="text-sm uppercase tracking-[0.35em] text-slate-500 dark:text-slate-400">Meta do mês</p>
                            <p class="text-2xl font-semibold text-slate-900 dark:text-white">76%</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Faltam 48 contas para fechar.</p>
                        </div>
                        <sl-button variant="success" pill>
                            <sl-icon slot="prefix" name="check2-circle"></sl-icon>
                            Registrar conquista
                        </sl-button>
                    </div>
                </div>
            </sl-card>

            <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                <div slot="header">
                    <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400">Quick Actions</p>
                    <p class="text-lg font-semibold text-slate-900 dark:text-white">Criar registro</p>
                </div>
                <form class="space-y-4">
                    <sl-input label="Título" placeholder="Nome da iniciativa"></sl-input>
                    <sl-select label="Responsável" placeholder="Selecione">
                        <sl-option value="ana">Ana Costa</sl-option>
                        <sl-option value="jonas">Jonas Poli</sl-option>
                        <sl-option value="marcos">Marcos Lima</sl-option>
                    </sl-select>
                    <sl-textarea label="Descrição" rows="3"></sl-textarea>
                    <sl-checkbox>Adicionar à lista de destaques</sl-checkbox>
                    <div class="flex justify-end gap-2">
                        <sl-button variant="default" outline>Cancelar</sl-button>
                        <sl-button variant="primary">Salvar</sl-button>
                    </div>
                </form>
            </sl-card>
        </section>

        <section class="grid gap-6 lg:grid-cols-[1.3fr_1fr]">
            <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                <div slot="header" class="flex flex-wrap items-center justify-between gap-3">
                    <p class="text-lg font-semibold text-slate-900 dark:text-white">Atividade recente</p>
                    <sl-button size="small" variant="default" outline>
                        <sl-icon slot="prefix" name="funnel"></sl-icon>
                        Filtrar
                    </sl-button>
                </div>
                <div class="space-y-4">
                    {% set timeline = [
                        { title: 'Novo cliente enterprise', detail: 'Contrato anual aprovado para Branch.ai', time: 'há 12 min' },
                        { title: 'Revisão de conteúdo', detail: 'Landing page do evento Flow foi publicada', time: 'há 1h' },
                        { title: 'Integração pronta', detail: 'Webhook do CRM conectado ao DataLake', time: 'há 2h' },
                        { title: 'Atualização financeira', detail: 'Relatório de MRR consolidado', time: 'há 4h' }
                    ] %}
                    {% for item in timeline %}
                        <div class="flex gap-4 rounded-2xl border border-slate-100/80 p-4 dark:border-white/5">
                            <sl-avatar shape="rounded" class="shrink-0" initials="{{ loop.index }}"></sl-avatar>
                            <div>
                                <p class="text-sm font-semibold text-slate-900 dark:text-white">{{ item.title }}</p>
                                <p class="text-sm text-slate-500 dark:text-slate-400">{{ item.detail }}</p>
                                <p class="text-xs text-slate-400 dark:text-slate-500">{{ item.time }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </sl-card>

            <sl-card class="border-none bg-white/80 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
                <div slot="header">
                    <p class="text-lg font-semibold text-slate-900 dark:text-white">Favoritos</p>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Acesso rápido a recursos internos</p>
                </div>
                <div class="space-y-3">
                    {% set shortcuts = [
                        { icon: 'file-earmark-text', label: 'Modelos de proposta' },
                        { icon: 'layout-text-window-reverse', label: 'Biblioteca de componentes' },
                        { icon: 'people-fill', label: 'Time de parceiros' },
                        { icon: 'chat-dots', label: 'Central de feedback' }
                    ] %}
                    {% for shortcut in shortcuts %}
                        <button class="flex w-full items-center justify-between rounded-xl border border-transparent px-4 py-3 text-left text-sm font-medium text-slate-700 transition hover:border-slate-200 hover:bg-slate-50 dark:text-slate-200 dark:hover:border-white/10 dark:hover:bg-white/5">
                            <span><sl-icon name="{{ shortcut.icon }}" class="mr-2 text-base text-slate-400"></sl-icon>{{ shortcut.label }}</span>
                            <sl-icon name="chevron-right"></sl-icon>
                        </button>
                    {% endfor %}
                </div>
            </sl-card>
        </section>

        <section class="space-y-6">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Livros e Progresso</h2>
            <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                {% for book in books %}
                    {% set visual = visuals[book.id] ?? null %}
                    {% set bgColorLight = visual ? visual.color_light : '#f8fafc' %}
                    {% set bgColorDark = visual ? visual.color_dark : '#1e293b' %}
                    {% set svgContent = visual ? visual.svg : '' %}
                    
                    <a href="{{ path('app_dashboard_chapters', {id: book.id}) }}" 
                       class="group relative overflow-hidden rounded-2xl p-6 transition-all hover:shadow-lg hover:shadow-slate-900/5 dark:hover:shadow-black/20 bg-[var(--book-color-light)] dark:bg-[var(--book-color-dark)]"
                       style="--book-color-light: {{ bgColorLight }}; --book-color-dark: {{ bgColorDark }};">
                        
                        {# Dark mode overlay - removed as we now handle bg color directly #}
                        {# <div class="absolute inset-0 transition-colors dark:bg-slate-900/90" style="background-color: transparent;"></div> #}
                        
                        {# SVG Background #}
                        <div class="absolute -right-6 -bottom-6 text-slate-900/5 dark:text-white/5 transition-transform group-hover:scale-110 group-hover:-rotate-6" style="color: {{ visual ? visual.color_dark : '#000' }}; opacity: 0.15;">
                            <svg width="128" height="128" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-32 w-32">
                                {{ svgContent|raw }}
                            </svg>
                        </div>

                        <div class="relative z-10">
                            <div class="flex items-center justify-between mb-4">
                                <span class="inline-flex items-center justify-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-white/50 dark:bg-black/20 text-slate-700 dark:text-slate-200 backdrop-blur-sm">
                                    {{ book.testament }}
                                </span>
                                <sl-icon name="chevron-right" class="text-slate-400 dark:text-slate-500 group-hover:text-slate-600 dark:group-hover:text-slate-300 transition-colors"></sl-icon>
                            </div>
                            
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-1 group-hover:underline decoration-2 underline-offset-2 decoration-slate-900/10 dark:decoration-white/20">
                                {{ book.name }}
                            </h3>
                            
                            <div class="mt-4">
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-slate-600 dark:text-slate-400 font-medium">Progresso</span>
                                    <span class="text-slate-900 dark:text-white font-bold">{{ book.progress|number_format(1) }}%</span>
                                </div>
                                <sl-progress-bar value="{{ book.progress }}" class="h-1.5" style="--indicator-color: {{ visual ? visual.color_dark : '#0ea5e9' }};"></sl-progress-bar>
                            </div>
                            
                            <div class="mt-4 flex gap-4 text-xs text-slate-500 dark:text-slate-400">
                                <div>
                                    <span class="block font-bold text-slate-700 dark:text-slate-200">{{ book.total_verses }}</span>
                                    Versículos
                                </div>
                                <div>
                                    <span class="block font-bold text-slate-700 dark:text-slate-200">{{ book.translated_verses }}</span>
                                    Traduzidos
                                </div>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </section>
    </div>

{% endblock %}
