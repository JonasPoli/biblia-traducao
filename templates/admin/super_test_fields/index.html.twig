{% extends 'admin/base.html.twig' %}

{% block title %}Super Test Fields{% endblock %}


{% set languagesEnum = enum('LanguageEnum') %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css">
{% endblock %}


{% block body %}
<div class="space-y-8">
    <section class="rounded-[32px] bg-white/80 p-6 shadow-xl shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-500 dark:text-slate-400">Super Test Fields</p>
                <h1 class="mt-2 text-3xl font-semibold text-slate-900 dark:text-white">Catálogo de Campos de Teste</h1>
                <p class="mt-2 max-w-2xl text-sm text-slate-500 dark:text-slate-400">
                    Demonstração de todos os tipos de campos e renderizações especiais.
                </p>
            </div>
            <div class="flex flex-wrap gap-3">
                <sl-button size="large" variant="primary" outline href="{{ path('app_admin_super_test_fields_new') }}">
                    <sl-icon slot="prefix" name="plus-lg"></sl-icon>
                    Novo Registro
                </sl-button>
            </div>
        </div>
    </section>

    <sl-card class="border-none bg-white/85 shadow-lg shadow-slate-900/5 ring-1 ring-white/70 backdrop-blur dark:bg-slate-900/70 dark:ring-white/10">
        <div slot="header" class="flex flex-wrap items-center justify-between gap-4">
            <div>
                <p class="text-lg font-semibold text-slate-900 dark:text-white">Lista de Registros</p>
                <p class="text-sm text-slate-500 dark:text-slate-400">
                    DataTables habilitado para busca e paginação.
                </p>
            </div>
        </div>

        {% if superTestFields is empty %}
            <sl-alert variant="neutral" open>
                <sl-icon slot="icon" name="inbox"></sl-icon>
                Nenhum registro ainda — clique em “Novo registro” para criar o primeiro item.
            </sl-alert>
        {% else %}
        <div class="overflow-x-auto">
            <table id="crud-table" class="min-w-full text-left text-sm">
                <thead>
                    <tr class="border-b border-slate-100 text-xs uppercase tracking-[0.3em] text-slate-500 dark:border-white/5 dark:text-slate-400">
                        <th class="py-3 pr-4">Texto</th>
                        <th class="py-3 pr-4">Editor</th>
                        <th class="py-3 pr-4">Enum</th>
                        <th class="py-3 pr-4">Data</th>
                        <th class="py-3 pr-4">Sim/Não (Int)</th>
                        <th class="py-3 pr-4">Boolean</th>
                        <th class="py-3 pr-4">Imagem</th>
                        <th class="py-3 pr-4">Email</th>
                        <th class="py-3 pr-4">Ações</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                {% for field in superTestFields %}
                    <tr class="hover:bg-slate-50/70 dark:hover:bg-white/5">
                        <td class="py-3 pr-4 font-medium text-slate-900 dark:text-white">{{ field.SimpleInputText }}</td>
                        <td class="py-3 pr-4 text-slate-600 dark:text-slate-300">{{ (field.EditTextWithEditor|slice(0, 50) ~ '...')|raw }}</td>
                        <td class="py-3 pr-4">{{ languagesEnum.getDescription(field.selectEnum)|raw }}</td>
                        <td class="py-3 pr-4">{{ field.DateField ? field.DateField|date('d/m/Y') : '' }}</td>
                        <td class="py-3 pr-4">
                            {% if field.SinNaoInt == 1 %}
                                <sl-badge variant="success" pill>Sim</sl-badge>
                            {% else %}
                                <sl-badge variant="danger" pill>Não</sl-badge>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4">
                            {% if field.BooleanTrueFalse %}
                                <sl-badge variant="success" pill>Sim</sl-badge>
                            {% else %}
                                <sl-badge variant="danger" pill>Não</sl-badge>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4">
                            {% if field.image %}
                                <img src="{{ vich_uploader_asset(field, 'imageFile') | imagine_filter('admin_thumb') }}" alt="" class="w-10 h-10 object-cover rounded-full">
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4">{{ field.emailField }}</td>
                        <td class="py-3 pr-4">
                            <div class="flex flex-wrap gap-2">
                                <sl-button size="small" variant="default" outline href="{{ path('app_admin_super_test_fields_show', {'id': field.id}) }}">
                                    <sl-icon slot="prefix" name="eye"></sl-icon>
                                    Ver
                                </sl-button>
                                <sl-button size="small" variant="primary" href="{{ path('app_admin_super_test_fields_edit', {'id': field.id}) }}">
                                    <sl-icon slot="prefix" name="pencil-square"></sl-icon>
                                    Editar
                                </sl-button>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="8" class="py-4 text-center text-slate-500">Nenhum registro encontrado.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </sl-card>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.3/js/dataTables.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof window.jQuery === 'undefined' || typeof window.jQuery.fn.DataTable === 'undefined') {
                return;
            }

            $('#crud-table').DataTable({
                pageLength: 100,
                lengthMenu: [[25, 50, 100, 250], [25, 50, 100, 250]],
                responsive: true,
                language: {
                    search: 'Buscar:',
                    info: 'Mostrando _START_ até _END_ de _TOTAL_ registros',
                    infoEmpty: 'Nenhum registro disponível',
                    lengthMenu: 'Mostrar _MENU_ itens',
                    paginate: {
                        first: 'Primeiro',
                        last: 'Último',
                        next: 'Próximo',
                        previous: 'Anterior'
                    },
                    zeroRecords: 'Nada encontrado'
                },
                order: [[0, 'desc']]
            });
        });
    </script>
{% endblock %}
